datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

model Huesped {
  id               Int      @id @default(autoincrement())
  nombre           String
  tipoDocumento    String
  numeroDocumento  String
  nacionalidad     String
  direccion        String
  lugarProcedencia String
  lugarDestino     String
  telefono         String
  email            String
  motivoViaje      String
  fechaIngreso     String
  fechaSalida      String
  numeroReserva    String   @unique
  creadoEn         DateTime @default(now())

  checkinUrl       String?
  codigoTTLock     String?

  // CAMPOS PARA ARCHIVOS
  archivoPasaporte String?
  archivoCedula    String?
  archivoFirma     String?

  passcodes        Passcode[]
}

model Passcode {
  id              Int      @id @default(autoincrement())

  // Relación con huésped
  huespedId       Int
  huesped         Huesped  @relation(fields: [huespedId], references: [id], onDelete: Cascade)

  // TTLock (Puerta)
  lockId          Int
  lockAlias       String?  // ej: "ALLYN", "Door 1 Ay", etc.

  // El código real (a veces NO viene en la respuesta)
  codigo          String?

  // ID que devuelve TTLock para ese passcode
  keyboardPwdId   Int?

  // Tipo de operación interna
  tipo            String   // "ADD" | "GET" | "SYNC" etc.

  // Vigencia (epoch en ms o s, lo que estés usando)
  startDate BigInt
  endDate   BigInt

  // Estado interno
  estado          String   @default("ACTIVO")

  // Estado/resultado TTLock
  ttlockOk        Boolean  @default(true)
  ttlockMessage   String?  // ej: "YA EXISTE", "CREADO", "ERROR: ..."

  // Auditoría
  creadoEn        DateTime @default(now())

  @@index([huespedId])
  @@index([lockId])
  @@index([keyboardPwdId])

  // Evita duplicar el mismo registro por puerta + id de TTLock
  @@unique([lockId, keyboardPwdId])
}
